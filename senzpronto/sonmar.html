<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sons de Chuva</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    :root{
      --brand:#3866A9; --brand-2:#4F8DDB;
      --bg1:#3866A9; --bg2:#121212;
      --card:#0f1419cc; --stroke:#1b1f25;
      --txt:#fff; --sub:#bfc6cf;
    }
    body{
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
      background:linear-gradient(180deg,var(--bg1),var(--bg2) 55%);
      color:var(--txt); padding-bottom:120px; position:relative;
    }

    .back{position:absolute; top:18px; left:18px; width:32px; height:32px; display:grid; place-items:center; cursor:pointer}
    .back svg{width:100%; height:100%; fill:#fff; opacity:.9; transition:.2s}
    .back:hover svg{transform:scale(1.08); opacity:1}

    .title{ text-align:center; font-size:28px; font-weight:800; margin-top:64px }
    .subtitle{ text-align:center; font-size:15px; margin:8px 0 18px; color:var(--sub) }

    .card{
      width:min(560px,92%); margin:0 auto; background:var(--card);
      border:1px solid var(--stroke); backdrop-filter:blur(8px);
      border-radius:18px; box-shadow:0 16px 48px rgba(0,0,0,.35);
      padding:16px 16px 14px;
    }
    .cover{ width:100%; height:300px; border-radius:14px; overflow:hidden }
    .cover img{ width:100%; height:100%; object-fit:cover; display:block }

    .row{ display:flex; justify-content:space-between; align-items:center; margin:10px 0 2px }
    .arrow{ width:32px; height:32px; display:grid; place-items:center; cursor:pointer }
    .arrow svg{ width:100%; height:100%; fill:#fff; opacity:.9; transition:.2s }
    .arrow:hover svg{ transform:scale(1.06); opacity:1 }

    .track-title{ text-align:center; font-size:22px; font-weight:800; color:var(--brand-2) }

    .controls{ display:flex; gap:10px; align-items:center; justify-content:center; margin-top:12px }
    .btn{
      background:var(--brand); color:#07130b; border:none; border-radius:999px;
      padding:10px 16px; font-size:14px; font-weight:900; letter-spacing:.2px; cursor:pointer;
      box-shadow:0 6px 16px rgba(56,102,169,.30); transition:.2s
    }
    .btn:hover{ background:var(--brand-2) }
    .btn.secondary{ background:#1c2127; color:#fff; border:1px solid #29313a; box-shadow:none }
    .btn.secondary:hover{ background:#232a32 }

    .bar{ position:relative; width:100%; height:8px; border-radius:999px;
      background:rgba(255,255,255,.1); margin:14px 0 6px; box-shadow:inset 0 0 0 1px rgba(255,255,255,.06); cursor:pointer }
    .bar-fill{ height:100%; width:0%; border-radius:999px;
      background:linear-gradient(90deg,#4F8DDB,#6EA2FF); box-shadow:0 0 16px rgba(79,141,219,.35) }
    .bar-knob{ position:absolute; top:50%; left:0%; transform:translate(-50%,-50%); width:14px; height:14px; border-radius:50%; background:#4F8DDB;
      box-shadow:0 0 0 3px rgba(79,141,219,.20), 0 6px 12px rgba(0,0,0,.25); pointer-events:none }
    .time{ display:flex; justify-content:space-between; color:var(--sub); font-size:12px }

    .choose{ display:block; margin:10px auto 0; background:#12171d; color:#fff; border:1px solid #24303b;
      padding:10px 14px; border-radius:12px; font-size:13px; cursor:pointer }
    .choose:hover{ background:#192029 }

    .sheet-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.4); display:none; align-items:flex-end; z-index:998 }
    .sheet{ background:#0f1419; border-top-left-radius:18px; border-top-right-radius:18px; width:100%; max-width:640px; margin:0 auto;
      border:1px solid #1b1f25; box-shadow:0 -10px 40px rgba(0,0,0,.45); padding:12px 14px 18px }
    .sheet h3{ text-align:center; font-size:16px; margin:6px 0 8px; color:#dfe7f0 }
    .playlist{ display:flex; flex-direction:column; gap:8px; max-height:46vh; overflow:auto; padding:6px 2px }
    .track{ display:grid; grid-template-columns:auto 1fr auto; gap:10px; align-items:center;
      padding:9px 10px; border-radius:12px; background:#0b1015; border:1px solid #1b2027; cursor:pointer; transition:.15s }
    .track:hover{ background:#10161d }
    .track.active{ background:#122035; outline:1px solid var(--brand-2) }
    .tcover{ width:38px; height:38px; border-radius:9px; overflow:hidden; background:#000 }
    .tcover img{ width:100%; height:100%; object-fit:cover }
    .tmain{ display:flex; flex-direction:column }
    .tname{ font-size:13px; font-weight:800 }
    .tartist,.tdur{ font-size:12px; color:var(--sub) }

    .dock{ position:fixed; bottom:20px; left:50%; transform:translateX(-50%); display:flex; gap:18px; background:#282828;
      padding:12px 20px; border-radius:24px; box-shadow:0 4px 16px rgba(0,0,0,.5); z-index:997 }
    .dock-icon{ width:42px; height:42px; border-radius:50%; background:#121212; display:grid; place-items:center; cursor:pointer; transition:.2s }
    .dock-icon:hover{ transform:scale(1.08); background:#4F8DDB }
    .dock-icon svg{ width:22px; height:22px; fill:#fff }
    .dock-icon.active{ background:#4F8DDB }
    .dock-icon.active svg{ fill:#000 }

    #yt-holder{ position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden }
  </style>
</head>
<body>

  <div class="back" onclick="window.location.href='musc.html'" aria-label="Voltar">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
  </div>

  <div class="title">Músicas Calmantes</div>
  <div class="subtitle">Práticas para aliviar o estresse</div>

  <div class="card">
    <div class="cover"><img src="./assets/img/chuva_ 1 (1).png" alt="Capa de chuva"></div>

    <div class="row">
      <div class="arrow" id="uiPrev" aria-label="Anterior">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
      </div>
      <div class="track-title" id="trackTitle">Chuva Relax 1</div>
      <div class="arrow" id="uiNext" aria-label="Próxima">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"/></svg>
      </div>
    </div>

    <div class="controls">
      <button class="btn secondary" id="prevBtn">◀ Anterior</button>
      <button class="btn" id="playBtn">▶ Tocar</button>
      <button class="btn secondary" id="nextBtn">Próxima ▶</button>
    </div>

    <div class="bar" id="progressBar" aria-label="Progresso">
      <div class="bar-fill" id="progressFill"></div>
      <div class="bar-knob" id="progressKnob"></div>
    </div>
    <div class="time"><span id="currTime">0:00</span><span id="totalTime">0:00</span></div>

    <!-- Botões principais -->
    <button class="choose" id="openPicker">🎵 Escolher músicas</button>
    <!-- NOVO: voltar para Sons da Natureza -->
    <button class="choose" onclick="window.location.href='sonnatu.html'">🌳 Voltar para Sons da Natureza</button>
  </div>

  <!-- Bottom-sheet -->
  <div class="sheet-overlay" id="sheet">
    <div class="sheet">
      <h3>Escolha uma música</h3>
      <div class="playlist" id="playlistEl"></div>
      <!-- NOVO atalho dentro do picker -->
      <button class="choose" onclick="window.location.href='sonnatu.html'">🌳 Voltar para Sons da Natureza</button>
      <button class="choose" id="closePicker">Fechar</button>
    </div>
  </div>

  <div class="dock">
    <div class="dock-icon" onclick="setActive(this); window.location.href='telainicial.html'">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
    </div>
    <div class="dock-icon active" onclick="setActive(this); window.location.href='intervencoes.html'">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41 .81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
    </div>
    <div class="dock-icon" onclick="setActive(this); window.location.href='historico.html'">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm1-13h-2v6h6v-2h-4z"/></svg>
    </div>
    <div class="dock-icon" onclick="setActive(this); window.location.href='dados.html'">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 17h2v-7H3v7zm4 0h2V7H7v10zm4 0h2v-4h-2v4zm4 0h2V4h-2v13zm4 0h2v-9h-2v9z"/></svg>
    </div>
    <div class="dock-icon" onclick="setActive(this); window.location.href='perfil.html'">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
    </div>
  </div>

  <div id="yt-holder"><div id="player"></div></div>
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    // ========= YouTube =========
    const YT_VIDEO_ID = "pWjmpSD-ph0";

    let segments = [
      { title:"Chuva Relax 1",  start:   0, end: 120 },
      { title:"Chuva Relax 2",  start: 120, end: 240 },
      { title:"Chuva Relax 3",  start: 240, end: 360 },
      { title:"Chuva Relax 4",  start: 360, end: 480 },
      { title:"Chuva Relax 5",  start: 480, end: 600 },
      { title:"Chuva Relax 6",  start: 600, end: 720 },
      { title:"Chuva Relax 7",  start: 720, end: 840 },
      { title:"Chuva Relax 8",  start: 840, end: 960 },
      { title:"Chuva Relax 9",  start: 960, end:1080 },
      { title:"Chuva Relax 10", start:1080, end:1200 },
      { title:"Chuva Relax 11", start:1200, end:1320 },
      { title:"Chuva Relax 12", start:1320, end:1440 }
    ];

    // ====== Refs ======
    const titleEl = document.getElementById("trackTitle");
    const playBtn = document.getElementById("playBtn");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const uiPrev  = document.getElementById("uiPrev");
    const uiNext  = document.getElementById("uiNext");
    const progressBar  = document.getElementById("progressBar");
    const progressFill = document.getElementById("progressFill");
    const progressKnob = document.getElementById("progressKnob");
    const currTimeEl = document.getElementById("currTime");
    const totalTimeEl = document.getElementById("totalTime");
    const playlistEl  = document.getElementById("playlistEl");
    const sheet       = document.getElementById("sheet");
    const openPicker  = document.getElementById("openPicker");
    const closePicker = document.getElementById("closePicker");

    // ====== Estado ======
    let player, playerReady=false;
    let index=0, isPlaying=false, pollId=null;

    // Player
    window.onYouTubeIframeAPIReady = function(){
      player = new YT.Player('player', {
        videoId: YT_VIDEO_ID,
        playerVars: { autoplay:0, controls:0, disablekb:1, fs:0, modestbranding:1, rel:0, playsinline:1 },
        events: { onReady:onPlayerReady }
      });
    };
    function onPlayerReady(){
      playerReady = true;
      renderPlaylist();
      loadTrack(0);
      updateButtons();
    }

    // ====== UI ======
    function formatTime(s){ if(!Number.isFinite(s)) return "0:00"; const m=Math.floor(s/60), r=Math.floor(s%60); return `${m}:${r.toString().padStart(2,"0")}` }
    function segDur(seg){ return Math.max(0,(seg.end - seg.start) || 0) }

    function renderPlaylist(){
      playlistEl.innerHTML = "";
      segments.forEach((t,i)=>{
        const el = document.createElement("div");
        el.className = "track";
        el.innerHTML = `
          <div class="tcover"><img src="./assets/img/chuva_ 1 (1).png" alt=""></div>
          <div class="tmain"><div class="tname">${t.title}</div><div class="tartist">YouTube</div></div>
          <div class="tdur">${formatTime(segDur(t))}</div>`;
        el.addEventListener("click", ()=>{ loadTrack(i); play(); hideSheet(); });
        playlistEl.appendChild(el);
      });
      highlightActive();
    }
    function highlightActive(){ [...playlistEl.children].forEach((el,i)=> el.classList.toggle("active", i===index)); }
    function updateButtons(){ playBtn.textContent = isPlaying ? "⏸ Pausar" : "▶ Tocar"; }

    // ====== Faixa ======
    function loadTrack(i){
      if(!playerReady) return;
      index = (i + segments.length) % segments.length;
      const seg = segments[index];
      titleEl.textContent = seg.title;
      totalTimeEl.textContent = formatTime(segDur(seg));
      highlightActive();
      player.seekTo(seg.start, true);
      if(isPlaying) startPoll();
      updateProgressUI(seg.start);
    }

    function play(){
      if(!playerReady) return;
      try{ player.unMute && player.unMute(); }catch{}
      player.playVideo();
      isPlaying = true;
      updateButtons();
      startPoll();
    }
    function pause(){
      if(!playerReady) return;
      player.pauseVideo();
      isPlaying = false;
      updateButtons();
      stopPoll();
    }

    // Botões
    playBtn.addEventListener("click", ()=> isPlaying ? pause() : play());
    prevBtn.addEventListener("click", ()=>{ loadTrack(index-1); play(); });
    nextBtn.addEventListener("click", ()=>{ loadTrack(index+1); play(); });
    uiPrev .addEventListener("click", ()=>{ loadTrack(index-1); play(); });
    uiNext .addEventListener("click", ()=>{ loadTrack(index+1); play(); });

    // Progresso / auto next
    function startPoll(){
      stopPoll();
      pollId = setInterval(()=>{
        const seg = segments[index];
        const t = player.getCurrentTime ? player.getCurrentTime() : 0;
        if(!Number.isFinite(t)) return;
        if(t >= seg.end - 0.1){
          loadTrack(index+1);
          player.seekTo(segments[index].start, true);
          player.playVideo();
          return;
        }
        updateProgressUI(t);
      }, 200);
    }
    function stopPoll(){ if(pollId){ clearInterval(pollId); pollId=null } }

    function updateProgressUI(absTime){
      const seg = segments[index];
      const rel = Math.max(0, Math.min((absTime - seg.start)/segDur(seg), 1));
      progressFill.style.width = `${rel*100}%`;
      progressKnob.style.left = `${rel*100}%`;
      currTimeEl.textContent = formatTime(rel * segDur(seg));
    }

    // Seek
    progressBar.addEventListener("click", (e)=>{
      if(!playerReady) return;
      const rect = progressBar.getBoundingClientRect();
      const ratio = Math.min(Math.max((e.clientX - rect.left)/rect.width, 0), 1);
      const seg = segments[index];
      const target = seg.start + ratio * segDur(seg);
      player.seekTo(target, true);
      if(isPlaying) startPoll();
    });

    // Picker
    function showSheet(){ sheet.style.display = "flex"; }
    function hideSheet(){ sheet.style.display = "none"; }
    openPicker.addEventListener("click", showSheet);
    closePicker.addEventListener("click", hideSheet);
    sheet.addEventListener("click", (e)=>{ if(e.target===sheet) hideSheet(); });

    // Dock
    function setActive(el){ document.querySelectorAll('.dock-icon').forEach(i=>i.classList.remove('active')); el.classList.add('active'); }
    window.setActive = setActive;
  </script>
</body>
</html>
